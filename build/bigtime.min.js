/*!
 * bigtime v0.2.0, https://github.com/hoho/bigtime
 * (c) 2013-2015 Marat Abdullin, MIT license
 */
!function(e,t,n){"use strict";var i,o=function(e){return"undefined"==typeof e},r=function(e){return"function"==typeof e},a=Math.floor,l=Math.ceil,f=Math.round,u=Math.abs,s=864e5,c=[{left:"0",label:"00:00"},{left:"12.5%",label:"03:00"},{left:"25%",label:"06:00"},{left:"37.5%",label:"09:00"},{left:"50%",label:"12:00"},{left:"62.5%",label:"15:00"},{left:"75%",label:"18:00"},{left:"87.5%",label:"21:00"}],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m="b-timeline",v=function(e,t){var n,i,o=e.style;for(n in t){i=t[n];try{o[n]=i+("number"==typeof i?"px":"")}catch(r){}}},h=function(e,t){"string"!=typeof e&&(t=e,e=n);var i,o=m+(e?"__"+e:""),r=[o];for(i in t)r.push(o+"_"+i+(t[i]===!0?"":"_"+t[i]));return r.join(" ")},p=function(e,t,n){return t=t||{},t["class"]=h(e,n),t},g=function(n,i){var r,a=function(t){var n,a=0;return t||(t=e.event),t.wheelDelta&&(a=-1*t.wheelDelta),t.detail&&(a=t.detail),t.deltaX&&0===a&&(a=t.deltaX),t.deltaY&&0===a&&(a=t.deltaY),t.wheelDeltaX&&0===a&&(a=t.wheelDeltaX),t.wheelDeltaY&&0===a&&(a=t.wheelDeltaY),n=u(a),(o(r)||r>n)&&(r=n),i(a/(r||1)),t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1};if(n.addEventListener){var l,f="onwheel"in t||t.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];for(l=0;l<f.length;l++)n.addEventListener(f[l],a,!1)}else n.onmousewheel=a},w=function(e,t){return function(){t.apply(e,arguments)}};i=e.Bigtime=function(m,b){var T,k,y,E,P,D,N,x,V,C,X,A,M,_,z,F,H,I,S,Y,G=this,B={minTime:0,maxTime:0,now:n,autoUpdate:!1,viewport:1,minViewport:n,maxViewport:n,preloadBefore:1,preloadAfter:1,scrollViewport:.5,scrollPreloadBefore:1,scrollPreloadAfter:1},L=function(r,s,c,d,m,w){var T,P,D,N,x,V,C,X,A,M,_,z,F,H,S,Y,G,B,L,$=this,O=p("mark",{"data-index":function(e){return e}}),W={},J={},R=function(e,t){$.push(e,t,[])},U=function(e,t){var n,i=J[e];i&&(delete J[e],i.timeframe&&(n=W[i.timeframe],delete n.events[e],delete n.unfinished[e],t||(n.eventsElem.removeChild(i.elem1),n.eventsElem.removeChild(i.elem2))))},j=function(e){if(o(W[e])){var t=W[e]={events:{},unfinished:{}},n=Y(e),i=Y(e+1);$C(r).div(p("timeframe")).act(function(){t.elem=this}).each(B(n,i)).div(p("tick",{style:{left:function(e){return e.left}}})).span().text(function(e){return e.label}).end(3).div(p("events-wrapper")).div(p("events")).act(function(){t.eventsElem=this}).div(p("future-overlay")).act(function(){t.futureElem=this}).end(5)}},q=function(e,t){var i,o,a=W[e];if(a){for(i in a.events)o=J[i],o.timeframe=n,t.push(o),delete J[i];r.removeChild(a.elem),delete W[e]}},K=function(){return o(x)&&(x=r.clientWidth),l(x*(1/A))},Q=function(){return-(_-D)*K()},Z=function(){if(!o(E)){var e,t,n,i,r,a,l=K();for(i=G(E),i>=N&&(i=N),r=f((i-D)*l),e=D;N>e;e++){n=W[e].unfinished;for(t in n)a=J[t],v(a.elem1,{width:r-a.left}),v(a.elem2,{width:r-a.left});r-=l}}},et=function(){var e,t,n,i,r,a=K(),l=f(Q());for(o(E)||(n=Y(D)),e=D;N>e;e++)t=W[e],v(t.elem,{left:l,width:a}),l+=a,o(E)||(i=Y(e+1),r={},E>=i?r.display="none":(r.display="",r.left=n>=E?0:f(a*(E-n)/(i-n))),v(t.futureElem,r),n=i);E!==S&&(S=E,Z())},tt=function(e){var t,r,a,u,s,c,d,m,h,p,g,w,b=[],T=K(),k={},y=i.EVENT_HSPACING/T,E=i.LETTER_WIDTH/T;for(t in J)a=J[t],b.push({begin:!0,event:a,sort:a.tbegin}),o(a.end)||((e||o(a.tend2))&&(a.tend2=a.tbegin+a.title.length*E+y,a.tend2-a.tend<y&&(a.tend2=a.tend+y)),b.push({begin:!1,event:a,sort:a.tend2}));for(b.sort(function(e,t){return e.sort<t.sort?-1:e.sort>t.sort?1:0}),m=-1,t=0;t<b.length;t++)u=b[t],a=u.event,a[u.begin?"i":"i2"]=t,a.positioned&&(m=t);for(t=0;t<b.length;t++)if(u=b[t],a=u.event,u.begin){if(a.positioned&&o(k[a.row]))k[r=a.row]=!0;else{if(w={},!e&&m>t&&!a.positioned)for(r=t+1;r<a.i2;r++)o(g=b[r].event.row)||(w[g]=!0);for(r=0;k[r]||w[r];)r++;k[a.row=r]=!0}if(e||!a.positioned){for(h=f((a.tbegin-a.timeframe)*T),p=l(r/2)*(i.EVENT_HEIGHT+i.EVENT_VSPACING)*(r%2===0?1:-1),v(a.elem1,{left:h,top:p,width:a.begin===a.end?"":f((a.tend-a.tbegin)*T)||1}),r=0,d=0,s=a.elem2.firstChild;r<a.marks.length;)c=f((G(a.marks[r])-a.timeframe)*T)-h,v(s,{left:d,width:c-d}),d=c,r++,s=s.nextSibling;v(a.elem2,{left:h,top:p,width:f((a.tend2-a.tbegin)*T)}),a.left=h,a.positioned=!0}}else k[a.row]=n;Z()},nt=function(e){if(e.length){var t,i,r,a,l,u,s=function(){r.elem1=this},c=function(){r.elem2=this};for(t=0;t<e.length;t++)r=e[t],a=G(r.begin),l=r.begin===r.end?a:G(o(r.end)?y:r.end),D>l||a>=N||(i=f((a+l)/2),r.timeframe=u=D>i?D:i>=N?N-1:i,u=W[u],r.tbegin=a,r.tend=l,u.events[r.id]=!0,o(r.end)&&(u.unfinished[r.id]=!0),J[r.id]=r,i=u.eventsElem,r.elem1?(i.appendChild(r.elem1),i.appendChild(r.elem2)):$C(i).div(r.color?{style:{"background-color":r.color}}:n).act(s).end().div({"data-id":r.id,title:r.title}).act(c).each(r.marks).span(O).end(2).text(r.title).end(2),i=n,r.begin===r.end&&(i={type:"point"}),r.elem2.className=h("event-overlay",i),o(r.end)&&(i={type:"unfinished"}),r.elem1.className=h("event",i),r.positioned=!1);tt()}},it=function(){var e,t;for(e=D,t=N-1;N>e&&!o(W[e].loading);)e++;for(;t>=D&&!o(W[t].loading);)t--;return t>=e?{timeframeFrom:e,timeframeTo:t+1,timeFrom:Y(e),timeTo:Y(t+1)}:void 0};$.getPosition=function(){return M},$.setPosition=function(t,i,r,f){if(!o(i)){var s=$.getX(M),c=u(M-i),d=M>i?-3:3,m=u(M-$.byX(s+d));m>c?(t=i,i=n):t=M+c/d}var v,h,p,g,b,T,E,P,x=[],I=o(i);for(V=A,z=i,F=r,H=f,v=M,_=G(k>t?k:t>y?y:t)-A/2,_>(t=G(y)-A)&&(_=t),_<(t=G(k))&&(_=t),M=Y(_+A/2),M>y&&(M=y),t=_,h=Y(a(t-C)),p=Y(l(t+A+X)),k>h&&(h=k),p>y&&(p=y),g=a(G(h)),b=l(G(p)),T=g;b>T;T++)j(T);if(!o(D)){for(T=D;g>T;T++)q(T,x);for(T=b;N>T;T++)q(T,x)}return D=g,N=b,et(),nt(x),(E=it())&&(L&&e.clearTimeout(L),P=function(){L=n,h=E.timeFrom,p=E.timeTo,$.status(h,p,!0,!1),R(h,p)},I?P():L=e.setTimeout(P,55)),I||M===v||e.requestAnimationFrame(function(){o(z)||$.setPosition(n,z,F,H)}),r&&r(M,v),w&&w(f,!I,M,v),M},$.status=function(t,n,i,o){var r,l,f=a(G(t)),u=a(G(n)),s=function(t){e.setTimeout(function(){t.className=h("timeframe")},0)};for(l=f;u>l;l++)(r=W[l])&&((!i||o)&&(r.loading&&(s(r.elem),r.loading=!1),o&&(r.error=!0)),i&&(r.elem.className=h("timeframe",{loading:!0}),r.loading=!0),o||(r.error=!1));if(!o)for(l=D;N>l;l++)if(W[l].error)return!0;return o},$.events=function(e){R=e},$.timing=function(e,t,n){Y=e,G=t,B=n},$.bounds=function(e,t,n){A=e,C=t,X=n},$.push=function(e,t,n){var i,r,a,l=[];for(i=0;i<n.length;i++)if(r=n[i],!o(r.begin)||!o(r.end)){if(a={id:r.id,data:r.data,title:r.title?r.title+"":"",begin:o(r.begin)?r.end:r.begin,end:r.end,marks:Array.prototype.slice.call(r.marks||[],0),color:r.color,positioned:!1},r=J[a.id]){if(r.data=a.data,r.title===a.title&&r.begin===a.begin&&r.end===a.end&&r.color===a.color&&r.marks.length===a.marks.length)continue;U(a.id,!0),a.row=r.row,a.elem1=r.elem1,v(a.elem1,{"background-color":a.color||""}),(r.title!==a.title||a.marks.length!==r.marks.length)&&$C(a.elem2,!0).each(a.marks).span(O).end(2).text(a.title).end(),a.elem2=r.elem2}a.marks.sort(),l.push(a)}return nt(l),$.status(e,t,!1,!1)},$.update=function(e){var t=Y(D),n=Y(N);$.setPosition(M),e&&$.status(t,n,!0,!1),R(t,n)},$.getX=function(e){return f((G(e)-D)*K()+Q()+10)},$.byX=function(e){var t=K();return Y((e+D*t-Q()-10)/t)},$.resize=function(){(r.clientWidth!==x||V!==A)&&(x=n,$.setPosition(M),tt(!0))},b(r,"mousedown",function(e){T=e.pageX}),b(r,"mousemove",function(e){o(T)||o(A)||e.pageX===T||($.setPosition(Y(G(M)+(T-e.pageX)/K())),T=e.pageX,P=!0)}),b(r,"mouseup",function(e){if(!P&&m){for(var t,n,i,o,a,l=e.target,u=l.className||"",s=r,c=e.pageX-f(Q())-1;s;)c-=s.offsetLeft,s=s.offsetParent;switch(u.indexOf(h("event-overlay"))>=0?t="event":u.indexOf(h("mark"))>=0&&(t="mark"),t){case"mark":n=l.parentNode,o=l.getAttribute("data-index");case"event":i=(n||l).getAttribute("data-id"),i&&I&&(a=J[i],"event"===t&&a.marks.length&&(o=a.marks.length))}m(e,Y(c/K()+D),i,o,(J[i]||{}).data)}}),b(t,"mouseup",function(){T=P=n}),b(s,"click",function(){$.setPosition(n,Y(G(M)-.4*A))}),b(c,"click",function(){$.setPosition(n,Y(G(M)+.4*A))}),g(r,function(e){o(k)||$.setPosition(Y(G(M)+A*e*.002))}),d&&b(t,"keydown",function(e){var t;switch(e.which){case 37:t=-1;break;case 39:t=1}t&&$.setPosition(Y(G(M)+t*A*(e.shiftKey?.4:.05)))})},$=function(){var e,t;T={};for(e in B)T[e]=r(t=B[e])?t():t;k=T.minTime,y=T.maxTime,E=T.now,P=T.autoUpdate,t=new Date(k),N=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),X.bounds(T.viewport,T.preloadBefore,T.preloadAfter),_.bounds(T.scrollViewport,T.scrollPreloadBefore,T.scrollPreloadAfter)},O=function(){D&&(e.clearTimeout(D),D=n),P>0&&(D=e.setTimeout(function(){D=n,$(),X.update()},P))};G.bounds=function(e){if(!o(e)){var t,n;for(t in B)o(n=e[t])||(B[t]=n)}return $(),v(C,{display:o(T.minViewport)||o(T.maxViewport)?"none":"block"}),G},G.events=function(e){return X.events(w(G,e)),G},G.timing=function(e,t,n){return X.timing(e,t,n),G},G.position=function(e){return o(e)?X.getPosition():($(),X.setPosition(e),G)},G.push=function(e,t,n){return H=X.push(e,t,n),H||v(x,{display:"none"}),O(),G},G.error=function(e,t,n){return v(x,{display:"block"}),$C(x.firstChild,!0).text(n).end(),H=X.status(e,t,!1,!0),O(),G},G.resize=function(){return $(),X.resize(),_.resize(),G},G.on=function(e,t){switch(t=w(G,t),e){case"click":I=t;break;case"position":S=t}return G};var W=function(){var e=this;b(e,"click",function(){if(T){var t=T.viewport,n=T.minViewport,i=T.maxViewport;o(n)||o(i)||(t+=.1*(e.className.indexOf("zoom-in")>0?-1:1),n>t&&(t=n),t>i&&(t=i),G.bounds({viewport:t}),G.resize())}})};$C(m,!0).div(p()).div(p("error-wrapper")).act(function(){x=this}).span(p("error")).end(2).div(p("scaler")).act(function(){C=this}).div(p("scaler-button",n,{"zoom-out":!0})).act(W).end().div(p("scaler-button",n,{"zoom-in":!0})).act(W).end().div(p("scaler-ruler")).end(2).div(p("left")).act(function(){A=this}).div().end(2).div(p("right")).act(function(){M=this}).div().end(2).div(p("timeframes")).act(function(){X=new L(this,A,M,!0,function(e,t,n,i,r){!o(n)&&I&&I(e,n,i,r)},function(e,t,n,i){n!==i&&(e||_.setPosition(o(i)?n:_.getPosition()+(n-i)),S&&!t&&S(n,i))})}).end().div(p("gap"),!0).div(p("pick")).act(function(){V=this}).end().div(p("left",n,{scrollbar:!0})).act(function(){z=this}).div().end(2).div(p("right",n,{scrollbar:!0})).act(function(){F=this}).div().end(2).div(p("scrollbar")).act(function(){_=new L(this,z,F,n,function(e,t){X.setPosition(n,t,function(e){v(V,{left:_.getX(e)-7})},!0)},function(){v(V,{left:f(_.getX(X.getPosition()))-7})})}).end(3),b(x,"click",function(){X.update(!0)}),X.timing(function(e){return e*s+N%s},function(e){return(e-N%s)/s},function(e){var t=new Date(e);return c[0].label=d[t.getMonth()]+" "+t.getDate()+" "+t.getFullYear(),c}),_.timing(function(e){var t=new Date(a(e),0,1).getTime(),n=new Date(a(e)+1,0,1).getTime();return t+(n-t)*(e-a(e))},function(e){var t=new Date(e).getFullYear(),n=new Date(t,0,1),i=new Date(t+1,0,1);return t+(e-n)/(i-n)},function(e,t){var n,i=new Date(e),o=[];for(n=0;12>n;n++)i.setMonth(n),o.push({left:100*(i.getTime()-e)/(t-e)+"%",label:d[i.getMonth()]+(n%3===0?", "+i.getFullYear():"")});return o}),b(e,"resize",function(){Y&&e.clearTimeout(Y),Y=e.setTimeout(function(){Y=n,G.resize()},100)})},i.EVENT_HEIGHT=30,i.EVENT_HSPACING=30,i.EVENT_VSPACING=5,i.LETTER_WIDTH=7.5}(window,document);